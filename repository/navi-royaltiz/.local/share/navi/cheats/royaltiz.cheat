% chain
#? nestjs
cd packages/services/shared/ && yarn build:lib && cd -
#? nestjs local services up
systemctl start docker.service --user && cd packages/services/ && docker-compose -f compose.test.yml up -d && cd -
#? nestjs local services down
cd packages/services/ && docker-compose -f compose.test.yml down && cd -
#? generate types
cd packages/shared/types && yarn build && yarn build:lib && cd -
#? remote
assume dev --exec -- aws eks update-kubeconfig --name workloads && assume dev --exec -- k9s

% db
#? nestjs local
yarn run migrate up
#? nestjs local
docker exec -it services-timescaledb-1 psql -U dev -d timeseries
#? nestjs local
docker exec -it services-cockroachdb-1 cockroach sql --insecure
#? nestjs local script
docker exec -i services-cockroachdb-1 cockroach sql --url "postgresql://dev:local@127.0.0.1:26257/local?sslmode=require" --format table < /tmp/query.sql
#? nestjs remote
assume dev --exec -- kubectl exec -it cockroachdb-main-0 -c db -n services -- cockroach sql --certs-dir=/cockroach/cockroach-certs
#? nestjs remote
assume dev --exec -- kubectl exec -it royaltiz-b6d4bd98-5gdjd -n services -- yarn migrate down 2

% dir
#? project
cd ~/workspace/royaltiz/platform-root
#? worktree
cd ~/workspace/royaltiz/platform-worktree
#? nestjs
cd packages/services/royaltiz
#? nestjs
cd packages/services/shared
#? nestjs compose
cd packages/services
#? Types
cd shared/types

% eks
#? remote
assume dev --exec -- aws eks update-kubeconfig --name workloads
#? k9s
assume dev --exec -- k9s

% git
#? overwrite local
git commit --amend --no-edit
#? overwrite remote
git commit --amend --no-edit && git push upstream HEAD -f

% test
#? nestjs
yarn run test:e2e --testPathPattern 'purchase.e2e-spec.ts'
#? lambda
roy --env dev.env test integration --grep ''
#? lambda logs
cat /tmp/pino.log | grep "" | ./node_modules/.bin/pino-pretty -H
